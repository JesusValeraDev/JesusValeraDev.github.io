<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jesus Valera Reales</title>
  <link rel="stylesheet" href="https://jesusvalera.dev/main.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Poppins:400,600" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="icon" type="image/png" sizes="32x32" href="https://jesusvalera.dev/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://jesusvalera.dev/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://jesusvalera.dev/assets/apple-touch-icon.png">

  
    <link type="application/atom+xml" rel="alternate" href="https://jesusvalera.dev/atom.xml" title="Jesus Valera Reales" />
  

  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K2RD5QTTM8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-K2RD5QTTM8');
    </script>
  

  
<title>How does the Service Container work? | Jesus Valera Reales</title>



<meta property="og:title" content="How does the Service Container work?">


<meta property="og:locale" content="en_US">


<meta name="description" content="What is a service container and how does it work? Let&#x27;s answer these questions and create one from scratch">
<meta property="og:description" content="What is a service container and how does it work? Let&#x27;s answer these questions and create one from scratch">



<link rel="canonical" href="https://jesusvalera.dev/how-does-the-service-container-work/">
<meta property="og:url" content="https://jesusvalera.dev/how-does-the-service-container-work/">



  <meta property="og:site_name" content="Jesus Valera Reales"/>



  <meta property="og:image" content="https://jesusvalera.dev/icon.ico">
  
  



  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-10-21T00:00:00+00:00">




<script type="application/ld+json">
{
  "description": "What is a service container and how does it work? Let&#x27;s answer these questions and create one from scratch",
  "url": "https://jesusvalera.dev/how-does-the-service-container-work/",
  "@context":"https://schema.org",
  "@type": "BlogPosting",
  "headline": "How does the Service Container work?"
  
    
    
      "datePublished":"2022-10-21T00:00:00+00:00",
    
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://jesusvalera.dev/how-does-the-service-container-work/"
    },
  
}
</script>
  <script type="text/javascript" src="https://jesusvalera.dev/snow.js" defer></script>
  <script type="text/javascript" src="https://jesusvalera.dev/dark-mode.js"></script>
</head>

<body>
<div id="snow"></div>
  
  <header>
    <a class="profile-icon" href="https://jesusvalera.dev">
      <img alt="JesusValera" src="https://jesusvalera.dev/jesus.webp" width="auto" height="auto">
    </a>
    <nav>
      
        <a href="https://jesusvalera.dev">Blog</a>
      
        <a href="https://jesusvalera.dev/readings">Readings</a>
      
        <a href="https://jesusvalera.dev/cv">CV</a>
      
      <button id="light-mode" onclick="toDarkMode()" title="Switch to dark mode">
        <svg width="20" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <path fill="#444" d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"></path>
        </svg>
      </button>
      <button id="dark-mode" onclick="toLightMode()" title="Switch to light mode">
        <svg width="20" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <path fill="#ccc" d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"></path>
        </svg>
      </button>
    </nav>
  </header>
  

  <main>
    
  <div class="post">
    <h1 class="post-title">How does the Service Container work?</h1>
    <h2 class="post-subtitle"></h2>
    <small>
      <time datetime="2022-10-21">
        <svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 20 20">
          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g transform="translate(-300, -2799)" fill="#AAAAAAFF">
              <g transform="translate(56, 160)">
                <path d="M262,2656 C262,2656.552 261.552,2657 261,2657 L247,2657 C246.448,2657 246,2656.552 246,2656 L246,2646 C246,2645.448 246.448,2645 247,2645 L261,2645 C261.552,2645 262,2645.448 262,2646 L262,2656 Z M262,2641 L262,2640 C262,2639.448 261.552,2639 261,2639 C260.448,2639 260,2639.448 260,2640 L260,2641 L255,2641 L255,2640 C255,2639.448 254.552,2639 254,2639 C253.448,2639 253,2639.448 253,2640 L253,2641 L248,2641 L248,2640 C248,2639.448 247.552,2639 247,2639 C246.448,2639 246,2639.448 246,2640 L246,2641 C244.895,2641 244,2641.895 244,2643 L244,2657 C244,2658.104 244.895,2659 246,2659 L262,2659 C263.105,2659 264,2658.104 264,2657 L264,2643 C264,2641.895 263.105,2641 262,2641 L262,2641 Z"></path>
              </g>
            </g>
          </g>
        </svg>
        October 21, 2022 ·
        <svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 24 24" fill="none">
          <path stroke="#AAAAAAFF" stroke-width="3" stroke-linecap="round" d="M12 7V12H15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"/>
        </svg>
        4 mins
      </time>
      <span class="found-typo">
        
        <svg width="12px" height="12px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" fill="#AAAAAAFF" d="M20.8477 1.87868C19.6761 0.707109 17.7766 0.707105 16.605 1.87868L2.44744 16.0363C2.02864 16.4551 1.74317 16.9885 1.62702 17.5692L1.03995 20.5046C0.760062 21.904 1.9939 23.1379 3.39334 22.858L6.32868 22.2709C6.90945 22.1548 7.44285 21.8693 7.86165 21.4505L22.0192 7.29289C23.1908 6.12132 23.1908 4.22183 22.0192 3.05025L20.8477 1.87868ZM18.0192 3.29289C18.4098 2.90237 19.0429 2.90237 19.4335 3.29289L20.605 4.46447C20.9956 4.85499 20.9956 5.48815 20.605 5.87868L17.9334 8.55027L15.3477 5.96448L18.0192 3.29289ZM13.9334 7.3787L3.86165 17.4505C3.72205 17.5901 3.6269 17.7679 3.58818 17.9615L3.00111 20.8968L5.93645 20.3097C6.13004 20.271 6.30784 20.1759 6.44744 20.0363L16.5192 9.96448L13.9334 7.3787Z"></path>
        </svg> Found a typo? <a href="https:&#x2F;&#x2F;github.com&#x2F;JesusValeraDev&#x2F;JesusValera.dev&#x2F;blob&#x2F;main&#x2F;content&#x2F;2022-10-21-how-does-the-service-container-work.md" target="_blank">Edit me</a>
      </span>
    </small>
    <div class="post-line"></div>
    <p><img src="/images/2022-10-21/1.png" alt="acropolis-greece" /></p>
<p>A <em>Service Container</em> is basically a class that behaves like a <em>box</em>, we can think of it as a <em>singleton</em> object (but it
is not, it is simply an object that is instantiated by the framework while it is being bootstrapped), on which we can
declare all of our dependencies to be resolved automatically by the framework.</p>
<p>The role of a <em>Service Container</em> is to define which classes (with their inner dependencies) should be resolved
automatically.</p>
<p>Usually, frameworks like Symfony or Laravel brings already a bunch of interfaces that will resolve automatically
specific classes. So, for <code>\Psr\Log\LoggerInterface</code> there is somewhere a class that implements this interface
like <code>Monolog</code> or any other.</p>
<p>Let's imagine we have a service whose dependency is a <code>UserRepository</code> (this dependency belongs to our use case, so it
is not defined in the framework), additionally, depending on the environment, we want to inject
a <code>PostgreSQLUserRepository</code> or a <code>InMemoryUserRespository</code> instance.</p>
<blockquote>
<p>This post will be based on the two most popular PHP frameworks (Symfony &amp; Laravel), but the idea works for any other
programming language/framework.</p>
</blockquote>
<h2 id="symfony">Symfony</h2>
<p>We can define our services as <code>php</code> or <code>yaml</code> file extension (you can define this configuration directly in
the <code>src/Kernel.php</code> file).</p>
<pre data-lang="php source" class="language-php source z-code"><code class="language-php source" data-lang="php source"><span class="z-source z-php"><span class="z-comment z-line z-number-sign z-php"><span class="z-punctuation z-definition z-comment z-php">#</span> config/services.php
</span><span class="z-meta z-namespace z-php"><span class="z-meta z-path z-php"><span class="z-keyword z-other z-namespace z-php">namespace</span> </span></span><span class="z-meta z-namespace z-php"><span class="z-meta z-path z-php"><span class="z-entity z-name z-namespace z-php"><span class="z-support z-other z-namespace z-php">Symfony</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Component</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">DependencyInjection</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Loader</span><span class="z-punctuation z-separator z-namespace z-php">\</span>Configurator</span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>

<span class="z-keyword z-control z-php">return</span> <span class="z-meta z-function z-closure z-php"><span class="z-storage z-type z-function z-php">function</span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-meta z-path z-php"><span class="z-support z-class z-php">ContainerConfigurator</span></span> <span class="z-variable z-parameter z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>containerConfigurator</span><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span><span class="z-meta z-function z-php"> <span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-begin z-php">{</span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php">
    <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>services</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>containerConfigurator</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">services</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>

    <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>services</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">set</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php">
        <span class="z-meta z-path z-php"><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Domain</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">UserRepository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span><span class="z-punctuation z-separator z-php">,</span>
        <span class="z-meta z-path z-php"><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Infrastructure</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">PostgreSQLUserRepository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span>
    <span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-end z-php">}</span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></code></pre>
<p>Alternatively, we can define a different instance for the <em>testing</em> environment:</p>
<pre data-lang="php source" class="language-php source z-code"><code class="language-php source" data-lang="php source"><span class="z-source z-php"><span class="z-comment z-line z-number-sign z-php"><span class="z-punctuation z-definition z-comment z-php">#</span> config/services_test.yml
</span><span class="z-meta z-namespace z-php"><span class="z-meta z-path z-php"><span class="z-keyword z-other z-namespace z-php">namespace</span> </span></span><span class="z-meta z-namespace z-php"><span class="z-meta z-path z-php"><span class="z-entity z-name z-namespace z-php"><span class="z-support z-other z-namespace z-php">Symfony</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Component</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">DependencyInjection</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Loader</span><span class="z-punctuation z-separator z-namespace z-php">\</span>Configurator</span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>

<span class="z-keyword z-control z-php">return</span> <span class="z-meta z-function z-closure z-php"><span class="z-storage z-type z-function z-php">function</span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-meta z-path z-php"><span class="z-support z-class z-php">ContainerConfigurator</span></span> <span class="z-variable z-parameter z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>containerConfigurator</span><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span><span class="z-meta z-function z-php"> <span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-begin z-php">{</span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php">
    <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>services</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>containerConfigurator</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">services</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>

    <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>services</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">set</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php">
        <span class="z-meta z-path z-php"><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Domain</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">UserRepository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span><span class="z-punctuation z-separator z-php">,</span>
        <span class="z-meta z-path z-php"><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Infrastructure</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">InMemoryUserRespository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span>
    <span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-end z-php">}</span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></code></pre>
<h2 id="laravel">Laravel</h2>
<p>In Laravel, however, you can do this in the <code>AppServiceProvider</code> class.</p>
<pre data-lang="php source" class="language-php source z-code"><code class="language-php source" data-lang="php source"><span class="z-source z-php"><span class="z-meta z-namespace z-php"><span class="z-meta z-path z-php"><span class="z-keyword z-other z-namespace z-php">namespace</span> </span></span><span class="z-meta z-namespace z-php"><span class="z-meta z-path z-php"><span class="z-entity z-name z-namespace z-php"><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span>Providers</span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>

<span class="z-meta z-class z-php"><span class="z-storage z-modifier z-abstract z-php">final </span><span class="z-storage z-type z-class z-php">class</span> <span class="z-entity z-name z-class z-php">AppServiceProvider</span> <span class="z-storage z-modifier z-extends z-php">extends</span> <span class="z-meta z-path z-php"><span class="z-entity z-other z-inherited-class z-php">ServiceProvider</span></span>
<span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-php">{</span></span></span><span class="z-meta z-class z-php"><span class="z-meta z-block z-php">
    <span class="z-storage z-modifier z-php">public</span> <span class="z-meta z-function z-php"><span class="z-storage z-type z-function z-php">function</span> <span class="z-entity z-name z-function z-php">register</span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span><span class="z-meta z-function z-return-type z-php"><span class="z-punctuation z-separator z-php">:</span> <span class="z-meta z-path z-php"><span class="z-support z-class z-php">void</span></span>
    <span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-begin z-php">{</span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php">
        <span class="z-keyword z-control z-php">if</span> <span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span><span class="z-meta z-function-call z-php"><span class="z-variable z-function z-php">env</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">&#39;</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">APP_ENV</span><span class="z-punctuation z-definition z-string z-end z-php">&#39;</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span> <span class="z-keyword z-operator z-comparison z-php">===</span> <span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">&#39;</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">test</span><span class="z-punctuation z-definition z-string z-end z-php">&#39;</span></span><span class="z-punctuation z-section z-group z-end z-php">)</span></span> <span class="z-punctuation z-section z-block z-begin z-php">{</span>
            <span class="z-variable z-language z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>this</span><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-other z-member z-php">app</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">bind</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php">
                <span class="z-meta z-path z-php"><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Domain</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">UserRepository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span><span class="z-punctuation z-separator z-php">,</span>
                <span class="z-meta z-path z-php"><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Infra</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">InMemoryUserRespository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span>
            <span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
        <span class="z-punctuation z-section z-block z-end z-php">}</span> <span class="z-keyword z-control z-php">else</span> <span class="z-punctuation z-section z-block z-begin z-php">{</span>
            <span class="z-variable z-language z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>this</span><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-other z-member z-php">app</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">bind</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php">
                <span class="z-meta z-path z-php"><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Domain</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">UserRepository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span><span class="z-punctuation z-separator z-php">,</span>
                <span class="z-meta z-path z-php"><span class="z-support z-other z-namespace z-php">App</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-other z-namespace z-php">Infra</span><span class="z-punctuation z-separator z-namespace z-php">\</span><span class="z-support z-class z-php">PostgreSQLUserRepository</span></span><span class="z-punctuation z-accessor z-double-colon z-php">::</span><span class="z-constant z-class z-php">class</span>
            <span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
        <span class="z-punctuation z-section z-block z-end z-php">}</span>
    </span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-end z-php">}</span></span></span>

    <span class="z-storage z-modifier z-php">public</span> <span class="z-meta z-function z-php"><span class="z-storage z-type z-function z-php">function</span> <span class="z-entity z-name z-function z-php">boot</span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span><span class="z-meta z-function z-return-type z-php"><span class="z-punctuation z-separator z-php">:</span> <span class="z-meta z-path z-php"><span class="z-support z-class z-php">void</span></span>
    <span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-begin z-php">{</span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php">
        <span class="z-comment z-line z-double-slash z-php"><span class="z-punctuation z-definition z-comment z-php">//</span> ...
</span>    </span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-end z-php">}</span></span></span>
</span></span><span class="z-meta z-class z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-php">}</span></span></span>
</span></code></pre>
<h3 id="injecting-the-dependencies-in-our-services">Injecting the dependencies in our services</h3>
<p>So, from now on, the next time we try to inject our interface <code>UserRepository</code> as a dependency in the constructor of
another class, eg:</p>
<pre data-lang="php source" class="language-php source z-code"><code class="language-php source" data-lang="php source"><span class="z-source z-php"><span class="z-meta z-class z-php"><span class="z-storage z-modifier z-abstract z-php">final </span><span class="z-storage z-type z-class z-php">class</span> <span class="z-entity z-name z-class z-php">UserCreator</span>
<span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-php">{</span></span></span><span class="z-meta z-class z-php"><span class="z-meta z-block z-php">
    <span class="z-storage z-modifier z-php">public</span> <span class="z-meta z-function z-php"><span class="z-storage z-type z-function z-php">function</span> <span class="z-entity z-name z-function z-php"><span class="z-support z-function z-magic z-php">__construct</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php">
        <span class="z-meta z-path z-php"><span class="z-support z-class z-php">private</span></span> <span class="z-meta z-path z-php"><span class="z-support z-class z-php">UserRepository</span></span> <span class="z-variable z-parameter z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>userRepository</span><span class="z-punctuation z-separator z-php">,</span>
    <span class="z-punctuation z-section z-group z-end z-php">)</span></span></span><span class="z-meta z-function z-php"> <span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-begin z-php">{</span></span></span><span class="z-meta z-function z-php"></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-end z-php">}</span></span></span>

    <span class="z-comment z-line z-double-slash z-php"><span class="z-punctuation z-definition z-comment z-php">//</span> ...
</span></span></span><span class="z-meta z-class z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-php">}</span></span></span>
</span></code></pre>
<p>The framework will handle it, checking firstly if we defined in our service provider the injected class and creating a
new instance of it. In case this class has any dependency, the framework will resolve them automatically recursively by
reflection until the class is ready, in case any dependency cannot be resolved or the dependency is a primitive, and we
didn't define the value, it will throw an exception.</p>
<div class="separator"></div>
<p>Let’s go deeper into the technical details, how could you create such a dependency resolver? This is how we did in
Gacela (<a href="https://github.com/gacela-project/container/blob/d3f0714306cbe1e77707741a4146411d84539f2a/src/Container/DependencyResolver.php">link</a>),
and this is a simplified version of it:</p>
<pre data-lang="php source" class="language-php source z-code"><code class="language-php source" data-lang="php source"><span class="z-source z-php"><span class="z-meta z-class z-php"><span class="z-storage z-modifier z-abstract z-php">final </span><span class="z-storage z-type z-class z-php">class</span> <span class="z-entity z-name z-class z-php">DependencyResolver</span>
<span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-php">{</span></span></span><span class="z-meta z-class z-php"><span class="z-meta z-block z-php">
    <span class="z-comment z-block z-documentation z-phpdoc z-php"><span class="z-punctuation z-definition z-comment z-begin z-php">/**</span> <span class="z-keyword z-other z-phpdoc z-php">@var</span> array&lt;class-string,mixed&gt; <span class="z-punctuation z-definition z-comment z-end z-php">*/</span></span>
    <span class="z-storage z-modifier z-php">private</span> <span class="z-support z-class z-php">array</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>container</span><span class="z-punctuation z-terminator z-expression z-php">;</span>

    <span class="z-storage z-modifier z-php">public</span> <span class="z-meta z-function z-php"><span class="z-storage z-type z-function z-php">function</span> <span class="z-entity z-name z-function z-php">resolve</span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-storage z-type z-php">string</span> <span class="z-variable z-parameter z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>className</span><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span><span class="z-meta z-function z-return-type z-php"><span class="z-punctuation z-separator z-php">:</span> <span class="z-storage z-type z-php">object</span>
    <span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-begin z-php">{</span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php">
        <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>reflectionClass</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-keyword z-other z-new z-php">new</span> <span class="z-meta z-path z-php"><span class="z-support z-class z-builtin z-php">ReflectionClass</span></span><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>className</span><span class="z-punctuation z-section z-group z-end z-php">)</span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
        <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>constructor</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>reflectionClass</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">getConstructor</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>

        <span class="z-comment z-line z-number-sign z-php"><span class="z-punctuation z-definition z-comment z-php">#</span> If constructor is empty, we can do a `new $className()`
</span>        <span class="z-keyword z-control z-php">if</span> <span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span><span class="z-constant z-language z-php">null</span> <span class="z-keyword z-operator z-comparison z-php">===</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>constructor</span><span class="z-punctuation z-section z-group z-end z-php">)</span></span> <span class="z-punctuation z-section z-block z-begin z-php">{</span>
            <span class="z-keyword z-control z-php">return</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>reflectionClass</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">newInstance</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
        <span class="z-punctuation z-section z-block z-end z-php">}</span>

        <span class="z-comment z-line z-number-sign z-php"><span class="z-punctuation z-definition z-comment z-php">#</span> If not empty, let&#39;s resolve the class dependencies
</span>        <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>dependencies</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-meta z-array z-empty z-php"><span class="z-punctuation z-section z-array z-begin z-php">[</span><span class="z-punctuation z-section z-array z-end z-php">]</span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
        <span class="z-keyword z-control z-php">foreach</span> <span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>constructor</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">getParameters</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span> <span class="z-keyword z-operator z-logical z-php">as</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>parameter</span><span class="z-punctuation z-section z-group z-end z-php">)</span></span> <span class="z-punctuation z-section z-block z-begin z-php">{</span>
            <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>paramName</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>parameter</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">getType</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span>?<span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">getName</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
            <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>dependencies</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-variable z-language z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>this</span><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-other z-member z-php">container</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>paramName</span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span>
                ?? <span class="z-variable z-language z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>this</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">resolve</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>paramName</span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span> <span class="z-comment z-line z-number-sign z-php"><span class="z-punctuation z-definition z-comment z-php">#</span> 🌀 Recursion
</span>        <span class="z-punctuation z-section z-block z-end z-php">}</span>

        <span class="z-comment z-line z-number-sign z-php"><span class="z-punctuation z-definition z-comment z-php">#</span> Finally, we store in the container the resolved class
</span>        <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>class</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>reflectionClass</span><span class="z-meta z-function-call z-method z-php"><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-function z-php">newInstanceArgs</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>dependencies</span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
        <span class="z-variable z-language z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>this</span><span class="z-punctuation z-accessor z-arrow z-php">-&gt;</span><span class="z-variable z-other z-member z-php">container</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>className</span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>class</span><span class="z-punctuation z-terminator z-expression z-php">;</span>

        <span class="z-keyword z-control z-php">return</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>class</span><span class="z-punctuation z-terminator z-expression z-php">;</span>
    </span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-end z-php">}</span></span></span>
</span></span><span class="z-meta z-class z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-php">}</span></span></span>
</span></code></pre>
<p>This is the idea of what a framework does under the hood; ideally, we should use a cache layer.
Using reflection takes a lot of resources, and it is very slow; additionally, we are not taking into consideration
different scenarios like what to do depending on whether the resolved parameter is a primitive or even a callable.</p>
<p><img src="/images/2022-10-21/2.png" alt="parthenon-greece" /></p>
<h2 id="reference">Reference:</h2>
<ul>
<li><a href="https://symfony.com/doc/current/service_container.html">Symfony — Service Container</a></li>
<li><a href="https://laravel.com/docs/9.x/container#binding-primitives">Laravel — Service Container</a></li>
<li><a href="https://gacela-project.com/docs/bootstrap/#bindings">Gacela — Bindings</a></li>
</ul>

  </div>

  <div class="pagination">
    
    <a href="#" class="top">Top</a>
    
  </div>

  </main>

  
  <footer>
    <div style="display: flex; justify-content: center; align-items: center">
      <span style="margin-right: 6px">
        <span>
          <a href="/other/parlamento-entre-el-rey-cristiano-y-el-sultan-moro/">&#10015;</a> ×
        </span>
        <a href="/atom.xml">RSS</a> &copy; <time datetime="2024">2024</time> - Jesus Valera Reales
      </span>
      <a href="https://github.com/JesusValeraDev" style="display: inline-block" target="_blank">
        <img alt="github" src="/about/github.svg" style="margin: auto" width="24" height="24">
      </a>
      <a href="https://www.linkedin.com/in/jesus-valera-reales/" style="display: inline-block" target="_blank">
        <img alt="linkedin" src="/about/linkedin.svg" style="margin: auto" width="24" height="24">
      </a>
    </div>
  </footer>
  
</body>
</html>
